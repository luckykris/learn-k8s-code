<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="987px" preserveAspectRatio="none" style="width:4342px;height:987px;background:#FFFFFF;" version="1.1" viewBox="0 0 4342 987" width="4342px" zoomAndPan="magnify"><defs><filter height="300%" id="f5tqt9978dudj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="2175" cy="20" fill="#000000" filter="url(#f5tqt9978dudj)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><path d="M2287.5,61.4023 L2287.5,69.9688 L2267.5,73.9688 L2287.5,77.9688 L2287.5,86.5352 A0,0 0 0 0 2287.5,86.5352 L2386.5,86.5352 A0,0 0 0 0 2386.5,86.5352 L2386.5,71.4023 L2376.5,61.4023 L2287.5,61.4023 A0,0 0 0 0 2287.5,61.4023 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2376.5,61.4023 L2376.5,71.4023 L2386.5,71.4023 L2376.5,61.4023 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="2293.5" y="78.4692">初始化日志等</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="185" x="2082.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="69" x="2092.5" y="71.1387">func Run(...)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="165" x="2092.5" y="85.1074">cmd/kubelet/app/server.go</text><path d="M2287.5,114.207 L2287.5,137.9063 L2267.5,141.9063 L2287.5,145.9063 L2287.5,169.6055 A0,0 0 0 0 2287.5,169.6055 L2528.5,169.6055 A0,0 0 0 0 2528.5,169.6055 L2528.5,124.207 L2518.5,114.207 L2287.5,114.207 A0,0 0 0 0 2287.5,114.207 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2518.5,114.207 L2518.5,124.207 L2528.5,124.207 L2518.5,114.207 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="2293.5" y="131.2739">1.环境检查配置初始化</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="2293.5" y="146.4067">2.生成KubeClient、EventClient等</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="2293.5" y="161.5396">3.获取当前container、cgroup等状态</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="185" x="2082.5" y="117.9375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="67" x="2092.5" y="139.0762">func run(...)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="165" x="2092.5" y="153.0449">cmd/kubelet/app/server.go</text><path d="M2287.5,193.4414 L2287.5,209.5742 L2267.5,213.5742 L2287.5,217.5742 L2287.5,233.707 A0,0 0 0 0 2287.5,233.707 L2564.5,233.707 A0,0 0 0 0 2564.5,233.707 L2564.5,203.4414 L2554.5,193.4414 L2287.5,193.4414 A0,0 0 0 0 2287.5,193.4414 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2554.5,193.4414 L2554.5,203.4414 L2564.5,203.4414 L2554.5,193.4414 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="2293.5" y="210.5083">1.初始化kubelect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="2293.5" y="225.6411">2.生成NewKubeGenericRuntimeManager</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="185" x="2082.5" y="189.6055"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115" x="2092.5" y="210.7441">func RunKubelet(...)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="165" x="2092.5" y="224.7129">cmd/kubelet/app/server.go</text><path d="M2265.5,261.9609 L2265.5,270.5273 L2245.5,274.5273 L2265.5,278.5273 L2265.5,287.0938 A0,0 0 0 0 2265.5,287.0938 L2366.5,287.0938 A0,0 0 0 0 2366.5,287.0938 L2366.5,271.9609 L2356.5,261.9609 L2265.5,261.9609 A0,0 0 0 0 2265.5,261.9609 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2356.5,261.9609 L2356.5,271.9609 L2366.5,271.9609 L2356.5,261.9609 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="2271.5" y="279.0278">启动kubelect</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="141" x="2104.5" y="257.543"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="2114.5" y="278.6816">func startKubelet(...)</text><path d="M2299.5,315.9297 L2299.5,324.4961 L2279.5,328.4961 L2299.5,332.4961 L2299.5,341.0625 A0,0 0 0 0 2299.5,341.0625 L2431.5,341.0625 A0,0 0 0 0 2431.5,341.0625 L2431.5,325.9297 L2421.5,315.9297 L2299.5,315.9297 A0,0 0 0 0 2299.5,315.9297 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2421.5,315.9297 L2421.5,325.9297 L2431.5,325.9297 L2421.5,315.9297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="2305.5" y="332.9966">1.启动kubelet线程</text><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="2080.5,311.5117,2279.5,311.5117,2269.5,328.4961,2279.5,345.4805,2080.5,345.4805" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="2090.5" y="332.6504">go k.Run(podCfg.Updates())</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="160" x="2095" y="365.4805"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="2105" y="386.6191">func (kl *Kubelet) Run</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="140" x="2105" y="400.5879">pkg/kubelet/kubelet.go</text><line style="stroke:#A80036;stroke-width:1.5;" x1="106.5" x2="3802" y1="433.418" y2="433.418"/><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="20,666.2773,203,666.2773,193,683.2617,203,700.2461,20,700.2461" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="30" y="687.416">go kl.volumeManager.Run</text><ellipse cx="106.5" cy="746.2461" fill="#FFFFFF" filter="url(#f5tqt9978dudj)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="106.5" cy="746.2461" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="245.5,548.9609,468.5,548.9609,458.5,565.9453,468.5,582.9297,245.5,582.9297" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="193" x="255.5" y="570.0996">go wait.Until(kl.syncNodeStatus)</text><path d="M490.5,617.9297 L490.5,634.0625 L470.5,638.0625 L490.5,642.0625 L490.5,658.1953 A0,0 0 0 0 490.5,658.1953 L666.5,658.1953 A0,0 0 0 0 666.5,658.1953 L666.5,627.9297 L656.5,617.9297 L490.5,617.9297 A0,0 0 0 0 490.5,617.9297 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M656.5,617.9297 L656.5,627.9297 L666.5,627.9297 L656.5,617.9297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="496.5" y="634.9966">1.访问api-server注册节点</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="496.5" y="650.1294">2.更新节点状态</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="237" x="233.5" y="621.0781"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="217" x="243.5" y="642.2168">func (kl *Kubelet) syncNodeStatus()</text><path d="M497.5,697.6133 L497.5,706.1797 L477.5,710.1797 L497.5,714.1797 L497.5,722.7461 A0,0 0 0 0 497.5,722.7461 L570.5,722.7461 A0,0 0 0 0 570.5,722.7461 L570.5,707.6133 L560.5,697.6133 L497.5,697.6133 A0,0 0 0 0 497.5,697.6133 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M560.5,697.6133 L560.5,707.6133 L570.5,707.6133 L560.5,697.6133 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="503.5" y="714.6802">重试逻辑</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="251" x="226.5" y="693.1953"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="231" x="236.5" y="714.334">func (kl *Kubelet) updateNodeStatus()</text><path d="M511,762.1641 L511,785.8633 L491,789.8633 L511,793.8633 L511,817.5625 A0,0 0 0 0 511,817.5625 L778,817.5625 A0,0 0 0 0 778,817.5625 L778,772.1641 L768,762.1641 L511,762.1641 A0,0 0 0 0 511,762.1641 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M768,762.1641 L768,772.1641 L778,772.1641 L768,762.1641 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="517" y="779.231">1.heartbeatClient获取远程node状态</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="517" y="794.3638">2.更新node状态kl.setNodeStatus(node)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="517" y="809.4966">3.访问api-server更新远端node状态</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="278" x="213" y="772.8789"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="258" x="223" y="794.0176">func (kl *Kubelet) tryUpdateNodeStatus(...)</text><ellipse cx="352" cy="863.5625" fill="#FFFFFF" filter="url(#f5tqt9978dudj)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="352" cy="863.5625" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="859.5,552.6914,1086.5,552.6914,1076.5,569.6758,1086.5,586.6602,859.5,586.6602" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="197" x="869.5" y="573.8301">go wait.Until(kl.updateRuntimeUp</text><path d="M1111,621.6602 L1111,637.793 L1091,641.793 L1111,645.793 L1111,661.9258 A0,0 0 0 0 1111,661.9258 L1442,661.9258 A0,0 0 0 0 1442,661.9258 L1442,631.6602 L1432,621.6602 L1111,621.6602 A0,0 0 0 0 1111,621.6602 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1432,621.6602 L1432,631.6602 L1442,631.6602 L1432,621.6602 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310" x="1117" y="638.7271">1.判断设置节点的状态Ready,以及一些condition信息</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="1117" y="653.8599">2.启动containerManager</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="246" x="845" y="624.8086"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="226" x="855" y="645.9473">func (kl *Kubelet) updateRuntimeUp()</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="353" x="791.5" y="696.9258"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="333" x="801.5" y="718.0645">func (kl *Kubelet) initializeRuntimeDependentModules()</text><path d="M1168,769.7305 L1168,785.8633 L1148,789.8633 L1168,793.8633 L1168,809.9961 A0,0 0 0 0 1168,809.9961 L1499,809.9961 A0,0 0 0 0 1499,809.9961 L1499,779.7305 L1489,769.7305 L1168,769.7305 A0,0 0 0 0 1168,769.7305 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1489,769.7305 L1489,779.7305 L1499,779.7305 L1489,769.7305 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310" x="1174" y="786.7974">1.判断设置节点的状态Ready,以及一些condition信息</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="1174" y="801.9302">2.启动containerManager</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="360" x="788" y="765.8945"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="243" x="798" y="787.0332">func (cm *containerManagerImpl) Start()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="340" x="798" y="801.002">pkg/kubelet/dockershim/cm/container_manager_linux.go</text><ellipse cx="968" cy="859.832" fill="#FFFFFF" filter="url(#f5tqt9978dudj)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="968" cy="859.832" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="1538,624.8086,1852,624.8086,1842,641.793,1852,658.7773,1538,658.7773" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="284" x="1548" y="645.9473">go wait.Until(kl.podKiller.PerformPodKillingWork</text><path d="M1891,705.1797 L1891,713.7461 L1871,717.7461 L1891,721.7461 L1891,730.3125 A0,0 0 0 0 1891,730.3125 L2195,730.3125 A0,0 0 0 0 2195,730.3125 L2195,715.1797 L2185,705.1797 L1891,705.1797 A0,0 0 0 0 1891,705.1797 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2185,705.1797 L2185,715.1797 L2195,715.1797 L2185,705.1797 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="1897" y="722.2466">从podKillingCh队列离取需要删除的pod执行删除</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="362" x="1509" y="693.7773"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="342" x="1519" y="714.916">func (pk *podKillerWithChannel) PerformPodKillingWork()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="177" x="1519" y="728.8848">pkg/kubelet/kubelet_pods.go</text><ellipse cx="1690" cy="787.7148" fill="#FFFFFF" filter="url(#f5tqt9978dudj)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="1690" cy="787.7148" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="2267,624.8086,2439,624.8086,2429,641.793,2439,658.7773,2267,658.7773" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="142" x="2277" y="645.9473">kl.statusManager.Start()</text><path d="M2493,705.1797 L2493,713.7461 L2473,717.7461 L2493,721.7461 L2493,730.3125 A0,0 0 0 0 2493,730.3125 L2862,730.3125 A0,0 0 0 0 2862,730.3125 L2862,715.1797 L2852,705.1797 L2493,705.1797 A0,0 0 0 0 2493,705.1797 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2852,705.1797 L2852,715.1797 L2862,715.1797 L2852,705.1797 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="2499" y="722.2466">从m.podStatusChannel获取pod状态与apiserver互相同步</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="250" x="2223" y="693.7773"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="2233" y="714.916">func (m *manager) Start()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="230" x="2233" y="728.8848">pkg/kubelet/status/status_manager.go</text><ellipse cx="2348" cy="787.7148" fill="#FFFFFF" filter="url(#f5tqt9978dudj)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="2348" cy="787.7148" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="2872,666.2773,3176,666.2773,3166,683.2617,3176,700.2461,2872,700.2461" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="274" x="2882" y="687.416">kl.runtimeClassManager.Start(wait.NeverStop)</text><ellipse cx="3019" cy="746.2461" fill="#FFFFFF" filter="url(#f5tqt9978dudj)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="3019" cy="746.2461" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><path d="M3365,629.2266 L3365,637.793 L3345,641.793 L3365,645.793 L3365,654.3594 A0,0 0 0 0 3365,654.3594 L3551,654.3594 A0,0 0 0 0 3551,654.3594 L3551,639.2266 L3541,629.2266 L3365,629.2266 A0,0 0 0 0 3365,629.2266 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3541,629.2266 L3541,639.2266 L3551,639.2266 L3541,629.2266 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="3371" y="646.2935">pod生命周期event生成线程</text><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="3234,624.8086,3345,624.8086,3335,641.793,3345,658.7773,3234,658.7773" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="3244" y="645.9473">kl.pleg.Start()</text><path d="M3403,697.6133 L3403,713.7461 L3383,717.7461 L3403,721.7461 L3403,737.8789 A0,0 0 0 0 3403,737.8789 L3628,737.8789 A0,0 0 0 0 3628,737.8789 L3628,707.6133 L3618,697.6133 L3403,697.6133 A0,0 0 0 0 3403,697.6133 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3618,697.6133 L3618,707.6133 L3628,707.6133 L3618,697.6133 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="3409" y="714.6802">1.查询运行的container并对比</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="3409" y="729.813">2.将变化时间传入g.eventChannel</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="197" x="3186" y="693.7773"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="177" x="3196" y="714.916">func (g *GenericPLEG) relist()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="3196" y="728.8848">pkg/kubelet/pleg/generic.go</text><ellipse cx="3284.5" cy="787.7148" fill="#FFFFFF" filter="url(#f5tqt9978dudj)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="3284.5" cy="787.7148" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="3718,453.418,3896,453.418,3886,470.4023,3896,487.3867,3718,487.3867" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="3728" y="474.5566">kl.syncLoop(updates, kl)</text><path d="M3950,511.8047 L3950,520.3711 L3930,524.3711 L3950,528.3711 L3950,536.9375 A0,0 0 0 0 3950,536.9375 L4330,536.9375 A0,0 0 0 0 4330,536.9375 L4330,521.8047 L4320,511.8047 L3950,511.8047 A0,0 0 0 0 3950,511.8047 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4320,511.8047 L4320,521.8047 L4330,521.8047 L4320,511.8047 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359" x="3956" y="528.8716">1.从configCh跟plegCh两个队列里取事件做对应增删本地状态</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="256" x="3674" y="507.3867"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="236" x="3684" y="528.5254">func (kl *Kubelet) syncLoopIteration(...)</text><path d="M3936.5,587.7578 L3936.5,596.3242 L3916.5,600.3242 L3936.5,604.3242 L3936.5,612.8906 A0,0 0 0 0 3936.5,612.8906 L4154.5,612.8906 A0,0 0 0 0 4154.5,612.8906 L4154.5,597.7578 L4144.5,587.7578 L3936.5,587.7578 A0,0 0 0 0 3936.5,587.7578 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4144.5,587.7578 L4144.5,597.7578 L4154.5,597.7578 L4144.5,587.7578 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="3942.5" y="604.8247">1.执行一个异步执行的podworker</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="229" x="3687.5" y="576.3555"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="3697.5" y="597.4941">func (kl *Kubelet) dispatchWork(..)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="175" x="3697.5" y="611.4629">pkg/kubelet/pod_workers.go</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="243" x="3680.5" y="659.293"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="223" x="3690.5" y="680.4316">func (p *podWorkers) UpdatePod(...)</text><path d="M3921.5,739.6641 L3921.5,748.2305 L3901.5,752.2305 L3921.5,756.2305 L3921.5,764.7969 A0,0 0 0 0 3921.5,764.7969 L4190.5,764.7969 A0,0 0 0 0 4190.5,764.7969 L4190.5,749.6641 L4180.5,739.6641 L3921.5,739.6641 A0,0 0 0 0 3921.5,739.6641 " fill="#FBFB77" filter="url(#f5tqt9978dudj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4180.5,739.6641 L4180.5,749.6641 L4190.5,749.6641 L4180.5,739.6641 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="3927.5" y="756.731">1.检查pod各种volumne挂载等同步的信息</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="199" x="3702.5" y="728.2617"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="3712.5" y="749.4004">func (kl *Kubelet) syncPod(...)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="140" x="3712.5" y="763.3691">pkg/kubelet/kubelet.go</text><polygon fill="#FEFECE" filter="url(#f5tqt9978dudj)" points="3707,811.1992,3907,811.1992,3897,828.1836,3907,845.168,3707,845.168" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="170" x="3717" y="832.3379">kl.containerRuntime.SyncPod</text><rect fill="#FEFECE" filter="url(#f5tqt9978dudj)" height="47.9375" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="328" x="3638" y="880.168"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="292" x="3648" y="901.3066">func (m *kubeGenericRuntimeManager) SyncPod</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="308" x="3648" y="915.2754">pkg/kubelet/kuberuntime/kuberuntime_manager.go</text><ellipse cx="3802" cy="959.1055" fill="#FFFFFF" filter="url(#f5tqt9978dudj)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="3802" cy="959.1055" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2175" x2="2175" y1="30" y2="50"/><polygon fill="#A80036" points="2171,40,2175,50,2179,40,2175,44" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2175" x2="2175" y1="97.9375" y2="117.9375"/><polygon fill="#A80036" points="2171,107.9375,2175,117.9375,2179,107.9375,2175,111.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2175" x2="2175" y1="165.875" y2="189.6055"/><polygon fill="#A80036" points="2171,179.6055,2175,189.6055,2179,179.6055,2175,183.6055" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2175" x2="2175" y1="237.543" y2="257.543"/><polygon fill="#A80036" points="2171,247.543,2175,257.543,2179,247.543,2175,251.543" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2175" x2="2175" y1="291.5117" y2="311.5117"/><polygon fill="#A80036" points="2171,301.5117,2175,311.5117,2179,301.5117,2175,305.5117" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2175" x2="2175" y1="345.4805" y2="365.4805"/><polygon fill="#A80036" points="2171,355.4805,2175,365.4805,2179,355.4805,2175,359.4805" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="106.5" x2="106.5" y1="700.2461" y2="735.2461"/><polygon fill="#A80036" points="102.5,725.2461,106.5,735.2461,110.5,725.2461,106.5,729.2461" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="352" x2="352" y1="582.9297" y2="621.0781"/><polygon fill="#A80036" points="348,611.0781,352,621.0781,356,611.0781,352,615.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="352" x2="352" y1="655.0469" y2="693.1953"/><polygon fill="#A80036" points="348,683.1953,352,693.1953,356,683.1953,352,687.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="352" x2="352" y1="727.1641" y2="772.8789"/><polygon fill="#A80036" points="348,762.8789,352,772.8789,356,762.8789,352,766.8789" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="352" x2="352" y1="806.8477" y2="852.5625"/><polygon fill="#A80036" points="348,842.5625,352,852.5625,356,842.5625,352,846.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="968" x2="968" y1="586.6602" y2="624.8086"/><polygon fill="#A80036" points="964,614.8086,968,624.8086,972,614.8086,968,618.8086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="968" x2="968" y1="658.7773" y2="696.9258"/><polygon fill="#A80036" points="964,686.9258,968,696.9258,972,686.9258,968,690.9258" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="968" x2="968" y1="730.8945" y2="765.8945"/><polygon fill="#A80036" points="964,755.8945,968,765.8945,972,755.8945,968,759.8945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="968" x2="968" y1="813.832" y2="848.832"/><polygon fill="#A80036" points="964,838.832,968,848.832,972,838.832,968,842.832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1690" x2="1690" y1="658.7773" y2="693.7773"/><polygon fill="#A80036" points="1686,683.7773,1690,693.7773,1694,683.7773,1690,687.7773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1690" x2="1690" y1="741.7148" y2="776.7148"/><polygon fill="#A80036" points="1686,766.7148,1690,776.7148,1694,766.7148,1690,770.7148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2348" x2="2348" y1="658.7773" y2="693.7773"/><polygon fill="#A80036" points="2344,683.7773,2348,693.7773,2352,683.7773,2348,687.7773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2348" x2="2348" y1="741.7148" y2="776.7148"/><polygon fill="#A80036" points="2344,766.7148,2348,776.7148,2352,766.7148,2348,770.7148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3019" x2="3019" y1="700.2461" y2="735.2461"/><polygon fill="#A80036" points="3015,725.2461,3019,735.2461,3023,725.2461,3019,729.2461" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3284.5" x2="3284.5" y1="658.7773" y2="693.7773"/><polygon fill="#A80036" points="3280.5,683.7773,3284.5,693.7773,3288.5,683.7773,3284.5,687.7773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3284.5" x2="3284.5" y1="741.7148" y2="776.7148"/><polygon fill="#A80036" points="3280.5,766.7148,3284.5,776.7148,3288.5,766.7148,3284.5,770.7148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3802" x2="3802" y1="487.3867" y2="507.3867"/><polygon fill="#A80036" points="3798,497.3867,3802,507.3867,3806,497.3867,3802,501.3867" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3802" x2="3802" y1="541.3555" y2="576.3555"/><polygon fill="#A80036" points="3798,566.3555,3802,576.3555,3806,566.3555,3802,570.3555" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3802" x2="3802" y1="624.293" y2="659.293"/><polygon fill="#A80036" points="3798,649.293,3802,659.293,3806,649.293,3802,653.293" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3802" x2="3802" y1="693.2617" y2="728.2617"/><polygon fill="#A80036" points="3798,718.2617,3802,728.2617,3806,718.2617,3802,722.2617" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3802" x2="3802" y1="776.1992" y2="811.1992"/><polygon fill="#A80036" points="3798,801.1992,3802,811.1992,3806,801.1992,3802,805.1992" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3802" x2="3802" y1="845.168" y2="880.168"/><polygon fill="#A80036" points="3798,870.168,3802,880.168,3806,870.168,3802,874.168" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3802" x2="3802" y1="928.1055" y2="948.1055"/><polygon fill="#A80036" points="3798,938.1055,3802,948.1055,3806,938.1055,3802,942.1055" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="106.5" x2="106.5" y1="434.918" y2="666.2773"/><polygon fill="#A80036" points="102.5,656.2773,106.5,666.2773,110.5,656.2773,106.5,660.2773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="352" x2="352" y1="434.918" y2="548.9609"/><polygon fill="#A80036" points="348,538.9609,352,548.9609,356,538.9609,352,542.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="968" x2="968" y1="434.918" y2="552.6914"/><polygon fill="#A80036" points="964,542.6914,968,552.6914,972,542.6914,968,546.6914" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1690" x2="1690" y1="434.918" y2="624.8086"/><polygon fill="#A80036" points="1686,614.8086,1690,624.8086,1694,614.8086,1690,618.8086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2348" x2="2348" y1="434.918" y2="624.8086"/><polygon fill="#A80036" points="2344,614.8086,2348,624.8086,2352,614.8086,2348,618.8086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3019" x2="3019" y1="434.918" y2="666.2773"/><polygon fill="#A80036" points="3015,656.2773,3019,666.2773,3023,656.2773,3019,660.2773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3284.5" x2="3284.5" y1="434.918" y2="624.8086"/><polygon fill="#A80036" points="3280.5,614.8086,3284.5,624.8086,3288.5,614.8086,3284.5,618.8086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3802" x2="3802" y1="434.918" y2="453.418"/><polygon fill="#A80036" points="3798,443.418,3802,453.418,3806,443.418,3802,447.418" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2175" x2="2175" y1="413.418" y2="433.418"/><polygon fill="#A80036" points="2171,423.418,2175,433.418,2179,423.418,2175,427.418" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[84f134720fa5634dd8f8ea1d11b750e6]
@startuml
start
:func Run(...)
cmd/kubelet/app/server.go;
note right
    初始化日志等
end note
:func run(...)
cmd/kubelet/app/server.go;
    note right
        1.环境检查配置初始化
        2.生成KubeClient、EventClient等
        3.获取当前container、cgroup等状态
    end note
:func RunKubelet(...)
cmd/kubelet/app/server.go;
    note right
        1.初始化kubelect
        2.生成NewKubeGenericRuntimeManager
    end note
:func startKubelet(...);
    note right
        启动kubelect
    end note
:go k.Run(podCfg.Updates())<
    note right
        1.启动kubelet线程
    end note
:func (kl *Kubelet) Run
pkg/kubelet/kubelet.go;
split
    :go kl.volumeManager.Run<
    stop
split again
    :go wait.Until(kl.syncNodeStatus)<
    :func (kl *Kubelet) syncNodeStatus();
        note right
            1.访问api-server注册节点
            2.更新节点状态
        end note
    :func (kl *Kubelet) updateNodeStatus();
        note right
            重试逻辑
        end note
    :func (kl *Kubelet) tryUpdateNodeStatus(...);
        note right
            1.heartbeatClient获取远程node状态
            2.更新node状态kl.setNodeStatus(node)
            3.访问api-server更新远端node状态
        end note
    stop
split again
    :go wait.Until(kl.updateRuntimeUp<
    :func (kl *Kubelet) updateRuntimeUp();
    note right
        1.判断设置节点的状态Ready,以及一些condition信息
        2.启动containerManager
    end note
    :func (kl *Kubelet) initializeRuntimeDependentModules();
    :func (cm *containerManagerImpl) Start()
    pkg/kubelet/dockershim/cm/container_manager_linux.go;
    note right
         1.判断设置节点的状态Ready,以及一些condition信息
         2.启动containerManager
    end note
    stop
split again
    :go wait.Until(kl.podKiller.PerformPodKillingWork<
    :func (pk *podKillerWithChannel) PerformPodKillingWork()
    pkg/kubelet/kubelet_pods.go;
    note right
        从podKillingCh队列离取需要删除的pod执行删除
    end note
    stop
split again
    :kl.statusManager.Start()<
    :func (m *manager) Start()
    pkg/kubelet/status/status_manager.go;
    note right
        从m.podStatusChannel获取pod状态与apiserver互相同步
    end note
    stop
split again
    :kl.runtimeClassManager.Start(wait.NeverStop)<
    stop
split again
    :kl.pleg.Start()<
       note right
           pod生命周期event生成线程
       end note
    :func (g *GenericPLEG) relist()
    pkg/kubelet/pleg/generic.go;
       note right
           1.查询运行的container并对比
           2.将变化时间传入g.eventChannel
       end note
    stop
split again
    :kl.syncLoop(updates, kl)<
    :func (kl *Kubelet) syncLoopIteration(...);
       note right
           1.从configCh跟plegCh两个队列里取事件做对应增删本地状态
       end note
    :func (kl *Kubelet) dispatchWork(..)
    pkg/kubelet/pod_workers.go;
       note right
           1.执行一个异步执行的podworker
       end note
    :func (p *podWorkers) UpdatePod(...);
    :func (kl *Kubelet) syncPod(...)
    pkg/kubelet/kubelet.go;
        note right
            1.检查pod各种volumne挂载等同步的信息
        end note
    :kl.containerRuntime.SyncPod<
    :func (m *kubeGenericRuntimeManager) SyncPod
    pkg/kubelet/kuberuntime/kuberuntime_manager.go;
    stop
end split
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>